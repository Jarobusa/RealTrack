AWSTemplateFormatVersion: '2010-09-09'
Description: RealTrack - DynamoDB (multi-tenant single-table)

Parameters:
  TableName:
    Type: String
    Default: RealTrack

Resources:
  RealTrackTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: !Ref TableName
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - { AttributeName: PK,     AttributeType: S }
        - { AttributeName: SK,     AttributeType: S }
        - { AttributeName: GSI1PK, AttributeType: S }
        - { AttributeName: GSI1SK, AttributeType: S }
        - { AttributeName: GSI2PK, AttributeType: S }
        - { AttributeName: GSI2SK, AttributeType: S }
      KeySchema:
        - { AttributeName: PK, KeyType: HASH }
        - { AttributeName: SK, KeyType: RANGE }
      GlobalSecondaryIndexes:
        - IndexName: GSI1
          KeySchema:
            - { AttributeName: GSI1PK, KeyType: HASH }
            - { AttributeName: GSI1SK, KeyType: RANGE }
          Projection: { ProjectionType: ALL }
        - IndexName: GSI2
          KeySchema:
            - { AttributeName: GSI2PK, KeyType: HASH }
            - { AttributeName: GSI2SK, KeyType: RANGE }
          Projection: { ProjectionType: ALL }
      # Server-side encryption (AWS-owned key; safest/zero-config)
      SSESpecification:
        SSEEnabled: true
      # Point-in-time recovery (continuous backups)
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: true
      Tags:
        - Key: app
          Value: RealTrack

Outputs:
  TableName:
    Value: !Ref RealTrackTable
  TableArn:
    Value: !GetAtt RealTrackTable.Arn